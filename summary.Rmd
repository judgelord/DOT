---
title: "DOT project summary"
output: 
   html_document:
    toc: true
    code_folding: hide
---
---

```{r setup, include=FALSE}
source("setup.R")


# ABSTRACT NOTES
# https://docs.google.com/document/d/1ZfwtacaTX3zldbmpV0rx868fiasGo-2dF3ZMkSWYk6s/edit?usp=sharing


  
  # 2016 OPM fedscope text files
  # https://www.dropbox.com/s/xe74anownix98bn/FederalEmployees.csv?dl=0
```

```{r global.options, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, 
                      cache = F, 
                      fig.width=8.5, fig.align = 'center', fig.path='Figs/',
                      warning=FALSE, message=FALSE)
```

# Abstract

Administrative rulemaking is often conceptualized as a straightforward translation of legislative delegations into agency rules, where bureaucrats adopt their most preferred policy given their constraints, often speeding up or slowing down the policy process to do so. The rulemaking process is indeed highly formulaic, requiring publication of a draft, external review, and public comment before a final rule is published. However, much of the politics of rulemaking may play out in the less formal and transparent process before a draft policy is published. In this stage, different priorities and constraints may drive decisions about which draft policies are published and when.

Theories of policymaking suggest that the politics of rulemaking may differ significantly in the pre-proposal stage. Yet, this part of the policy process has largely eluded quantitative study due to a lack of systematic data. This paper begins to fill this gap. We introduce a new dataset based on thousands of monthly internal project status reports by the U.S. Department of Transportation that allow us to track a rulemaking effort from its origin date through its finalization.  Additionally, we develop a number of novel measures of prioritization and constraints that we are able to measure before and after a draft rule is made public,  including the degree of agency resource constraints, internal agency prioritization, changes in sub-agency political appointees, congressional and presidential attention, and the threat of litigation and sanction by courts.

Using these new data and measures, we model the drivers of prioritization and constraint as a multi-stage policy process and identify different political forces at work in each stage. Specifically, we use a multi-stage hazard model to test factors that may affect the timing of rules being proposed or finalized thus identify predictors of prioritization and delay. Previous research suggests that that greater internal agency resources—in terms of personnel and budgets—will speed up rulemaking during the largely opaque pre-proposal stage, while attention from external actors, including Congress and the president, will speed up rulemaking during the more transparent notice and comment period. Our data and measures allow new tests of these theories. We show that resources, complexity, and salience have different effects on the speed of rule-writing across different stages.

Our findings hold important implications for our understanding of transparency and bureaucratic policymaking within a representative democracy.




---

# To-do:

### Data

Find a method to identify the year of each rule's authorizing statute

Add OIRA report dates 

Infer missing withdrawal dates from the date last observed in stage withdrawal

Add subagency administrators and secretary data

OPM staff resources data for years other than 2016 

### Model

Devin will draft core model




---





# Data

```{r data}
load(here("data/DOT-monthly.Rdata"))
dotMonthly %<>% filter(!is.na(initiated)) # select rule-month observations with a dot report

load(here("data/DOT-perRule-perStage.Rdata"))
dotStage %<>% filter(!is.na(initiated)) # select rule-stage observations with a dot report

load(here("data/DOT-perRule.Rdata"))
dotRIN %<>% filter(!is.na(initiated)) # select rule observations with a dot report

dotMonthly %<>% group_by(RIN) %>% 
  mutate(delay = paste(na.omit(color), collapse = ",")) %>%
  mutate(delayedever = grepl("Red|Yellow", delay)) 
```

[Google spreadsheet of variables](https://docs.google.com/spreadsheets/d/1CptLu6Xz7K14KF8PyELsiy-siYZHpi5jjmS9hMyO1xM/edit?usp=sharing)

### Summary Stats
```{r summarystats}
# HOW MANY WITH REASON (NOTE NEED TO CORRECT WHYDELAY CONCAT)
# dotRIN$whydelay1 <- gsub("N/A",NA,dotRIN$whydelay1)
# sum(!is.na(dotRIN$whydelay1))
sum(!is.na(dotRIN$whydelay))  %>%
write("stats/RINsWithReasonsForDelay.tex")

# HOW MANY DELAYED
filter(dotRIN, color %in% c("Red", "Yellow")) %>%
  n_distinct(.$RIN) %>%
  write("stats/RINsDelayed.txt")

# HOW MANY NOT DELAYED WHEN PUBLISHED
filter(dotRIN, color %in% c("Black", "Green")) %>%
  n_distinct(.$RIN) %>%
  write("stats/RINsNotDelayed.tex")

# HOW MANY AT EACH STAGE 
n_distinct(dotRIN$RIN)   %>% write("stats/uniqueRINs.tex")

sum(!is.na(dotRIN$ANPRMpublished))   %>% write("stats/ANPRMs.tex")

sum(!is.na(dotRIN$ANPRM_RECIEVED))  %>% write("stats/ANPRMs-recieved-by-OMB.tex")

sum(!is.na(dotRIN$ANPRMtoOST))  %>% write("stats/ANPRMs-to-OST.tex")

sum(!is.na(dotRIN$NPRMpublished))   %>% write("stats/NPRMs.tex")

sum(!is.na(dotRIN$NPRMtoOST))  %>% write("stats/NPRMs-to-OST.tex")

sum(!is.na(dotRIN$NPRM_RECIEVED))  %>% write("stats/NPRMs-recieved-by-OMB.tex")

sum(!is.na(dotRIN$SNPRMpublished))   %>% write("stats/SNPRMs.tex")

sum(!is.na(dotRIN$SNPRM_RECIEVED))  %>% write("stats/SNPRMs-recieved-by-OMB.tex")

sum(!is.na(dotRIN$IFRpublished))   %>% write("stats/IFRs.tex")

sum(!is.na(dotRIN$IFR_RECIEVED))  %>% write("stats/IFRs-recieved-by-OMB.tex")

sum(!is.na(dotRIN$FinalRulePublished))   %>% write("stats/FinaldotRIN.tex")

sum(!is.na(dotRIN$FINAL_RECIEVED))  %>% write("stats/FinaldotRIN-recieved-by-OMB.tex")

sum(!is.na(dotRIN$WithdrawalPublished))  %>% write("stats/Withdrawals.tex")



#############################################################
# days-until-EVENT 
#############################################################
dotRIN %>% 
  filter(!is.na(DaysUntilANPRM)) %>% 
  summarise(mean(DaysUntilANPRM)) %>%
  first()   %>% write("stats/days-until-ANPRM.tex")

dotRIN %>% 
  filter(!is.na(DaysUntilNPRM)) %>% 
  summarise(mean(DaysUntilNPRM)) %>%
  first()   %>% write("stats/days-until-NPRM.tex")

dotRIN %>% 
  filter(!is.na(DaysUntilFinalRule)) %>% 
  summarise(mean(DaysUntilFinalRule)) %>%
  first()   %>% write("stats/days-until-final.tex")


dotRIN %>% 
  filter(!is.na(DaysUntilOSTANPRM)) %>% 
  summarise(mean(DaysUntilOSTANPRM)) %>%
  first()   %>% write("stats/days-until-ANPRM-to-OST.tex")

dotRIN %>% 
  filter(!is.na(DaysUntilOSTNPRM)) %>% 
  summarise(mean(DaysUntilOSTNPRM)) %>%
  first()   %>% write("stats/days-until-NPRM-to-OST.tex")

dotRIN %>% 
  filter(!is.na(DaysUntilOSTFinalRule)) %>% 
  summarise(mean(DaysUntilOSTFinalRule)) %>%
  first()   %>% write("stats/days-until-Final-to-OST.tex")

dotRIN %>% 
  filter(!is.na(DaysUntilWithdrawal)) %>% 
  summarise(mean(DaysUntilWithdrawal)) %>%
  first()  %>% write("stats/days-until-Withdrawal.tex")

# how many initiated post-2008
dotRIN %>% 
  filter(initiated > as.Date("2008-01-01")) %>% 
  #filter(!is.na(FinalRulePublished)) %>%  
  n_distinct(.$RIN) %>%
  first() %>% write("stats/initiatedSince2008.tex")

  # unique(dotRIN$prompt)
```
  


We have initiation dates for `r length(unique(dotRIN$RIN))` unique RINs. Of these, `r sum(dotRIN$color == "Red", na.rm = T)` were marked 'delayed,'`r sum(dotRIN$color == "Yellow", na.rm = T)` were marked 'potentially delayed,' and `r sum(dotRIN$color == "Green", na.rm = T)` were marked 'on time' at the time they were last observed. However, DOT increasingly marks projects as 'not on a schedule' (`r sum(dotRIN$color == "Black", na.rm = T)` RINs were last observed in the “Black” category). `r dim(filter(dotMonthly, delayedever == T, !is.na(DOTdate)) %>% select(RIN) %>% distinct())[1]` projects were delayed at some point and `r sum(!is.na(dotRIN$whydelay))` of these give a reason for delay.

`r sum(dotRIN$initiated > as.Date("2008-01-01"), na.rm = T)` RINs were initiated after 2008. `r sum(grepl("Final Rule", dotRIN$STAGE), na.rm = T)` have Final Rules Published, `r sum(dotStage$STAGE == "Withdrawal", na.rm =T)` have been withdrawn, and `r sum(dotStage$STAGE == "Termination", na.rm =T)` were terminated.



This table shows the average number of months after initiation at which certian milestones are reached:

| *MONTHS:*   | to Secretary| to ORIA | Published | *N* |
| ------------------ | ------------- | ---------------- | -------------------- | --------- |
|ANPRM              | `r round(mean(dotStage$DaysUntilOSTANPRM, na.rm = T)/30)` |`r round(mean(dotStage$DaysUntilOMBANPRM, na.rm = T)/30)` | `r round(mean(dotStage$DaysUntilANPRM, na.rm = T)/30)`| n = `r sum(dotStage$STAGE == "Prerule", na.rm =T)` |
|NPRM               |`r round(mean(dotStage$DaysUntilOSTNPRM, na.rm = T)/30)` |`r round(mean(dotStage$DaysUntilOMBNPRM, na.rm = T)/30)` | `r round(mean(dotStage$DaysUntilNPRM, na.rm = T)/30)`| n = `r sum(dotStage$STAGE == "Proposed Rule", na.rm =T)` |
|SNPRM              |`r round(mean(dotStage$DaysUntilOSTSNPRM, na.rm = T)/30)` |`r round(mean(dotStage$DaysUntilOMBSNPRM, na.rm = T)/30)` | `r round(mean(dotStage$DaysUntilSNPRM, na.rm = T)/30)`| n = `r sum(dotStage$STAGE == "SNPRM", na.rm = T)` |
|Interim Final Rule  |`r round(mean(dotStage$DaysUntilOSTIFR, na.rm = T)/30)` |`r round(mean(dotStage$DaysUntilOMBIFR, na.rm = T)/30)` | `r round(mean(dotStage$DaysUntilIFR, na.rm = T)/30)`| n = `r sum(dotStage$STAGE == "Interim Final Rule", na.rm =T)`|
|Final Rule         |`r round(mean(dotStage$DaysUntilOSTFinalRule, na.rm = T)/30)` |`r round(mean(dotStage$DaysUntilOMBFinalRule, na.rm = T)/30)` | `r round(mean(dotStage$DaysUntilFinalRule, na.rm = T)/30)`| n = `r sum(grepl("Final Rule", dotRIN$STAGE), na.rm = T)`|
|Withdrawal         |`r round(mean(dotStage$DaysUntilOSTWithdrawal, na.rm = T)/30)` |`r round(mean(dotStage$DaysUntilOMBWithdrawal, na.rm = T)/30)` | `r round(mean(dotStage$DaysUntilWithdrawal, na.rm = T)/30)`| n = `r sum(dotStage$STAGE == "Withdrawal", na.rm =T)`|
|Termination        |||| n = `r sum(dotStage$STAGE == "Termination", na.rm =T)`|

\Sexpr{knit_child('stats/days-until-ANPRM-to-OST.tex')}



---

Adding DOT Internal Status Reports to OIRA and Unified Agenda Reports gives a richer picture of rulemaking. Data by RIN, date, and source:
```{r timeline, fig.height = 17}
# If project is ongoing, define enddate as date last observed (for plotting active project status)
dotMonthly %<>% mutate(end = if_else( is.na(enddate), reportdate, enddate) )

# Consolidate like stages for plotting:
dotMonthly$STAGE %<>% {gsub("Terminat.*", "Withdrawal",.)}
dotMonthly$STAGE %<>% {gsub(".2$", "", .)}
dotMonthly$STAGE %<>% {gsub(".3$", "", .)}
dotMonthly$STAGE %<>% {gsub(".4$", "", .)}
dotMonthly$STAGE %<>% {gsub("Notice", "Proposed Rule", .)}
dotMonthly$STAGE %<>% {gsub("Other", "Undetermined", .)}
dotMonthly$STAGE %<>% {gsub("Prerule", "Proposed Rule", .)}
dotMonthly$STAGE %<>% {gsub("Interim Final Rule", "Final Rule", .)}
dotMonthly$STAGE %<>% {gsub("SNPRM", "Proposed Rule", .)}

dotMonthly %>% # filter(reportdate > as.Date("2008-01-01")) %>%
ggplot(aes(x = RIN)) + 
  geom_linerange(aes(ymin=initiated, ymax=end, color="DOT Reports"), size=.1) +
  geom_point(aes(y = DOTdate, color = "DOT Reports", shape = STAGE), size = .5) +
  geom_point(aes(y = ANPRMpublished, color = "DOT Reports"), shape = 2, size = .5) +
  geom_point(aes(y = NPRMpublished, color = "DOT Reports"), shape = 2, size = .5) +
  geom_point(aes(y = SNPRMpublished, color = "DOT Reports"), shape = 2, size = .5) +
  geom_point(aes(y = FinalRulePublished, color = "DOT Reports"), shape = 1, size = .5) +
  geom_point(aes(y=IFRpublished, color = "DOT Reports"), shape = 1, size = .5) +
  geom_point(aes(y=WithdrawalPublished), color="red", shape = 4, size = 1) +
  geom_point(aes(y=Terminated), color="red4", shape = 4, size = 1) +
  geom_point(aes(y = DATE_RECEIVED, color = "OIRA Reports", shape = STAGE), size = .5) +
  geom_point(aes(y = UnifiedAgendaDate, color = "Unified Agenda Reports", shape = STAGE), size = .5) +
  facet_grid(acronym~., scales = "free_y", space = "free_y")+
  coord_flip() +
  scale_y_date(lim = c(as.Date("2000-01-01"), as.Date("2019-01-01")),
             breaks=date_breaks(width = "1 year"), 
             labels = date_format("%y"),
             minor_breaks=NULL) + 
  ggtitle('Significant DOT Rulemaking Projects Active Between 2008 and 2017') + 
  labs( x = "RIN", y = "Date", color = "", shape = "")+
  theme(axis.text.y = element_text(size = 3,
                       angle = 0,
                       hjust = 1,
                       vjust = 1),
        axis.ticks = element_blank(),
        strip.text.y = element_text(angle = 0),
        strip.background = element_blank(),
        legend.position = "top") 
```

Notice how the DOT (esp. FTA and FHA) initiated a large number of projects shortly after Obama's reelection, probably waiting for assurance that they would be able to complete their work.  


---

```{r hist-stages}
# stage histogram 
ggplot(dotMonthly %>% filter(STAGE %in% c("Withdrawal","Proposed Rule", "Other", "Final Rule", "Interim Final Rule"))) +
  stat_count(aes(DOTdate)) +
  facet_grid(STAGE~., scales = "free_y") +
  labs(title = "Active per Month by Stage", x = "")
  #scale_y_date(breaks=date_breaks(width = "1 year"), labels = date_format("%y"), minor_breaks=NULL)
```

```{r hist-stages-published, include=FALSE}
# publication histogram 

  ggplot(dotRIN %>% filter(STAGE %in% c("Withdrawal","Proposed Rule", "Final Rule", "Interim Final Rule")), 
         aes(publicationactual, na.rm = T)) +
    geom_histogram(na.rm = T, bins = length(unique(dotRIN$year)))  + 
    facet_grid(STAGE~., scales = "free_y") +
  labs(title = "Published by Stage", x = "")
  #scale_y_date(breaks=date_breaks(width = "1 year"), labels = date_format("%y"), minor_breaks=NULL)
```

```{r hist-promting-action}


# Consolidate like stages for plotting:
dotRIN$STAGE %<>% {gsub("Terminat.*", "Withdrawal",.)}
dotRIN$STAGE %<>% {gsub(".2$", "", .)}
dotRIN$STAGE %<>% {gsub(".3$", "", .)}
dotRIN$STAGE %<>% {gsub(".4$", "", .)}
dotRIN$STAGE %<>% {gsub("Notice", "Proposed Rule", .)}
dotRIN$STAGE %<>% {gsub("Other", "Undetermined", .)}
dotRIN$STAGE %<>% {gsub("Prerule", "Proposed Rule", .)}
dotRIN$STAGE %<>% {gsub("Interim Final Rule", "Final Rule", .)}
dotRIN$STAGE %<>% {gsub("SNPRM", "Proposed Rule", .)}

  dotRIN %>% filter(STAGE %in% c("Final Rule", "Withdrawal")) %>%  mutate(end = if_else( is.na(enddate) & DOTdate != "2018-09-01", reportdate, enddate) ) %>% #filter(prompt %in% c("Secretarial/Head of Operating Administration Decision","2011 Retrospective Regulatory Review" , "International Agreement", Settlement Agreement") ) %>% 
  ggplot() +  
  geom_point(aes(x = initiated, y = end, color = prompt, shape = STAGE)) + 
  scale_y_date(limits = c(as.Date("2008-01-01"),as.Date("2019-01-01")),
               breaks=date_breaks(width = "1 year"), 
             labels = date_format("%Y") )+

    #geom_smooth(aes(x= if_else(initiated > as.Date("2008-01-01"), initiated, NA), y= enddate), method = "lm" ) +
  labs(title = "Completed Rulemaking Projects by Prompting Reason and Outcome", x = "Initiated", y = "Published", color = "Prompt to Initiate Project", shape = "")
```






---

---

# Core Model

add core model




# Covariates

## Congressional attention/opposition: 

2018 appropriations subcommittee report. Below are examples of positive and negative sentiment about the FAA. Much it is very neutral, but it is fair to say that this actually reflects neutral attitudes. Sentiment analysis allows us to tally up the positive and negative words for each subagency. Other scholars have measured the length of the section on each subagency, but this mostly just reflects the size and diversity of its budget.

#### Examples:

POSITIVE: 

The Committee is encouraged 
by the additional measures the FAA is taking to enhance 
outreach to communities affected by new flightpaths. The 
Committee recommendation includes an additional $2,000,000 to 
support the FAA's ongoing efforts to address community noise 
concerns.
The Committee supports 
research that is being conducted through the FAA's Center of 
Excellence for Alternative Jet Fuel and Environment, the 
Aviation Sustainability Center (ASCENT) on the impact of 
aviation noise on both sleep and cardiovascular health.
The Committee commends the FAA Office 
of Commercial Space Transportation's efforts to promote private 
sector lunar exploration and development and encourages the FAA 
to explicitly define non-interference and to enhance its 
payload review process to provide companies planning private 
sector lunar development with the security and predictability 
necessary to support substantial investments. 

NEGATIVE:

The Committee is concerned by the FAA's decision to 
extend by five years its aging Mission Support Network, a 
decision which carries both technology and cost implications. 



# Notes

#### DOT - Unified Agenda rule stage crosswalk:

 [1] "Final Rule"  = Final Rule                         
 [2] "Undetermined" = Undetermined                        
 [3] "NPRM" = Proposed Rule                                
 [4] "SNPRM" = Prerule                               
 [5] "Interim Final Rule/4" = Interim Final Rule                
 [6] "Interim Final Rule" = Interim Final Rule                  
 [7] "Withdrawal" = Withdrawal                          
 [8] "Other" = Undetermined                               
 [9] "ANPRM" = Prerule                               
[10] "Final Rule/2" = Final Rule/2                        
[11] "NPRM/2"= Proposed Rule                               
[12] "SNPRM/2"= SNPRM                             
[13] "Notice" = Notice                              
[14] "Supplemental Notice of Intent" = Prerule       
[15] "Reconsideration of Final Rule" = Final Rule      
[16] "Disposition of Comments" = Other            
[17] "Request for Comments" = Other                
[18] "Final Rule with Request for Comments" = Final Rule
[19] "Termination"  = Termination (or Withdrawal in summary figures)



---


#### Covariates: 

[Google spreadsheet of variables](https://docs.google.com/spreadsheets/d/1CptLu6Xz7K14KF8PyELsiy-siYZHpi5jjmS9hMyO1xM/edit?usp=sharing)

##### Resources 
Resources measures:

- "lack of resources" or "lack of staffing" claimed [0,1], subset of delayed rules

- number of SES / # of rules per year (ideally at sub-agency level if we have SES data for that)

- secretary prompt - how many missing? 

##### Complexity  

Complexity measurements:

- "coordination necessary" claimed [0,1], subset of delayed rules

- the score of the abstract on Benoit's political sophistication/complexity

- second comment period [1,0] (though this may also be a measure of external, interest group constraint) 

- the number of comments? (to me this is more about salience and contentiousness than complexity)

##### Contentiousness: 
 White House and Secretary alignment measures:
 
- "other, higher priorities" claimed [0,1] (is it right to interpret this way? Priority could also be internal)

- initiated under same president [0,1] (same party president? we have a few started under Clinton, finished under Obama) 

- went to Secretary twice [0,1]

- days between going to secretary going to ORIA (average if multiple times)

- went to ORIA twice [0,1]

- Did ORIA make changes [0,1]

- days between going to ORIA and final rule (count from the first or last time at ORIA? )

Congress alignment measures:

- positive-negative sentiment words in subcommittee budget report

- positive-negative sentiment words in the subcommittee hearing

- legislative deadline exists [0,1]

- legislative deadline past [0,1]

- prompting action is legislation [0,1] (speeds up rulemaking?)

- legislation is pending [0,1] (slows rulemaking)

- Reg flex required [0,1] slowing? 

- unified congress 

Litigation threat:

- court deadline exists [0,1]

- court deadline past [0,1]

- number of lawsuits against the subagency in the past x years

- avg number of lawsuits against the agency per year of administration (this is perhaps better suited for a model that is not just DOT)

- litigation threatened in comments? [0,1]